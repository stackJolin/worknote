### 音视频播放原理

##### 音视频主要涉及到的技术

- 封装技术
- 视频压缩、音频压缩，编解码
- 流媒体协议



##### 播放视频文件需要经过以下几个步骤

- 解协议(本地视频不需要解协议)

  就是将流媒体协议的数据，解析为标准的相应的封装格式数据。视音频在网络上传播的时候，常常采用各种流媒体协议，例如HTTP，RTMP，或是MMS等等。这些协议在传输视音频数据的同时，也会传输一些信令数据。这些信令数据包括对播放的控制（播放，暂停，停止），或者对网络状态的描述等。解协议的过程中会去除掉信令数据而只保留视音频数据。例如，采用RTMP协议传输的数据，经过解协议操作后，输出FLV格式的数据。

- 解封装

  就是将输入的封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。封装格式种类很多，例如MP4，MKV，RMVB，TS，FLV，AVI等等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放到一起。例如，FLV格式的数据，经过解封装操作后，输出H.264编码的视频码流和AAC编码的音频码流。

- 解码音视频

  就是将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据。音频的压缩编码标准包含AAC，MP3，AC-3等等，视频的压缩编码标准则包含H.264，MPEG2，VC-1等等。解码是整个系统中最重要也是最复杂的一个环节。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如YUV420P，RGB等等；压缩编码的音频数据输出成为非压缩的音频抽样数据，例如PCM数据。

- 音视频同步

  就是根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。

##### 流媒体大致的三个层级

- 码流

  - SEI — Supplemental Enhancement Infomation，属于码流范畴，他提供了相视频码流中加入额外信息的方法，是H.264/H.265这些视频压缩标准的特性之一。SEI的基本特性如下

    - 并非解码过程的必选项
    - 可能对解码过程(容错、纠错)有帮助
    - 集成在视频码流中

    SEI可以添加哪些信息：

    - 传递编码器参数
    - 传递视频版权信息
    - 传递摄像头参数
    - 传递内容生成过程中的剪辑事件(引发场景切换)

- 封装

- 协议

  从音视频编码器输出的码流，经过某种封装格式后，经过特定的协议传输、保存，构成了流媒体世界的基础功能

  

