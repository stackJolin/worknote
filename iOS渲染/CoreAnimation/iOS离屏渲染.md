## iOS离屏渲染



在开始之前，我们首先要对`离屏渲染`这个概念，做一下介绍。通过了解`离屏渲染`，要弄明白几个问题：

- 造成`离屏渲染`的根本原因是什么
- `离屏渲染`和`CPU`以及`GPU`的关系
- 为什么要避免`离屏渲染`，或者说`离屏渲染`到底有哪些弊端



#### 什么是离屏渲染

-----

首先，离屏渲染讲的是`GPU`的渲染方式，`GPU`有两种渲染方式：

- `On-Screen-Rendered`：当前屏幕渲染
- `Off-Screen-Redered`：非当前屏幕渲染

iOS页面显示流程是，CPU将需要显示的内容进行处理，例如顶点、图元、颜色等信息，处理完成后交给GPU进行渲染，渲染后放在一个和屏幕像素数据量一样大的缓存空间frame buffer里面，这也就是GPU存储渲染结果的地方。

但是有时候有多个图层，当对下面图层做一些处理，例如圆角，并且要求上面子图层需要跟父图层做一样的处理，这个时候就需要将每个图层的渲染结果存储在另外的内存区域`offscreen Buffer`，然后所有图层都渲染完成后，作为处理后再将结果写入到frame buffer里面，这个过程就被称之为离屏渲染。



#### iOS中造成离屏渲染的操作

------

- conerRadius + clickToBounds：圆角+裁剪
- shouldRasterize：光栅化
- mask
- alpha
- 高斯模糊
- 投影
- 绘制了文字的layer