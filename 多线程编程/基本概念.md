## 基本概念

------





#### 同步与互斥

--------

术语“同步”在不同的上下文之中有不同的具体含义，比如同步IO与异步IO中的“同步”指的是用户线程与内核线程之间的协作形式，而java Synchronized中的“同步”又隐含着将cache中的数据同步到内存这层语义。这里明确本文讨论的“同步”指的是并发程序片段的同步，他通常与互斥、锁等概念一起出现。

同步：

```markdown
这里的同步指的是：对于同一片段程序的多个不同可调度实体，必须以先后顺序执行调度。
```

互斥:

```markdown
互斥指的是：对于同一片段程序，不能同时被多个可调度实体执行。他和同步的区别在于，他并不要求执行顺序
```



#### 原子操作

-------

定义：不可被中断的一个或者一系列操作。

###### 处理器如何实现原子操作？

- 处理器会自动保证基本的内存操作的原子性，也就是一个处理器从内存中读取或者写入一个字节时，其他内存是不能访问这个字节的内存地址。但处理器不能自动保证复杂的内存操作的原子性，比如跨总线宽度、跨多个缓存行或者跨页表的操作。
- 总线锁定和缓存锁定是处理器保证复杂内存操作原子性的两个机制。



#### 总线锁定和缓存锁定

-----

`总线锁定`指的是，一个处理器在总线上输出LOCK#信号，使得其他处理器对内存的操作请求都会被阻塞，该处理器独占共享内存。

由于总线缓存阻止了被阻塞处理器和所有内存之间的通信，而输出LOCK#信号的CPU可能只需要锁住特定的一块内存区域，因此总线锁定开销较大。

`缓存锁定`指的是某个CPU对缓存数据进行更改时，会通知缓存了该数据的CPU抛弃缓存的数据或者从内存重新读取。



#### 临界资源/临界区/竞态条件

----------

竞态条件：多线程的核心矛盾是“竞态条件”，即多个线程同时读写某个字段。

临界资源/静态资源：竞态条件下多线程争抢的是“竞态资源”。

临界区：涉及读写竟态资源的代码片段叫“临界区”。



#### 内存模型

--------



#### 线程安全

-------

线程安全的代码能在多线程或并发任务中被安全的调用，而不会导致任何问题（数据损坏，崩溃，等）。线程不安全的代码在某个时刻只能在一个上下文中运行。一个线程安全代码的例子是 **NSDictionary**。你可以在同一时间在多个线程中使用它而不会有问题。另一方面，**NSMutableDictionary** 就不是线程安全的，应该保证一次只能有一个线程访问它。



#### 上下文切换

---------

一个上下文切换指当你在单个进程里切换执行不同的线程时存储与恢复执行状态的过程。这个过程在编写多任务应用时很普遍，但会带来一些额外的开销。

